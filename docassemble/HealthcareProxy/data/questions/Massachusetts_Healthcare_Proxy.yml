comment: |
  The metadata section controls the tab title and saved interview title. You can delete this section if you include this YAML file in another YAML file.
metadata:
  title: |
    Massachusetts Healthcare Proxy Form
  short title: |
    Healthcare Proxy
---
comment: |
  This section is used by MAVirtualCourts to control how some of the questions work.
mandatory: True
code: |
  interview_metadata # make sure we initialize the object
  if not defined("interview_metadata['Massachusetts_Healthcare_Proxy']"):
    interview_metadata.initializeObject('Massachusetts_Healthcare_Proxy')
  interview_metadata['Massachusetts_Healthcare_Proxy'].update({
    'title': 'Massachusetts Healthcare Proxy Form',
    'short title': 'Healthcare Proxy',
    'description': 'This form can be used to designate someone to make healthcare decisions on your behalf if you are unable to do so.',
    'original_form': '',
    'allowed courts': [
    ],
    'categories': [
      'Health and Mental Health',
    ],
    'logic block variable': 'Massachusetts_Healthcare_Proxy',
    'attachment block variable': 'Massachusetts_Healthcare_Proxy_attachment',
    'typical role': 'plaintiff',
  })
---
include:
  - docassemble.AssemblyLine:al_package.yml
  - docassemble.MassAccess:massaccess.yml
---
features:
  navigation: True
---
sections:
  - review_Massachusetts_Healthcare_Proxy: Review your answers
---
mandatory: True
id: interview_order_Massachusetts_Healthcare_Proxy
code: |
  # This is a placeholder to control logic flow in this interview

  proxy_questions_intro_screen
  Massachusetts_Healthcare_Proxy_intro
  # Set the allowed courts for this interview
  allowed_courts = interview_metadata["Massachusetts_Healthcare_Proxy"]["allowed courts"]
  warning_screen
  has_representative
  user_role = 'plaintiff'
  users[0].name.first
  users[0].name.middle
  users[0].name.last
  users[0].name.suffix
  users[0].address.address
  users[0].birthdate
  has_exceptions
  if has_representative:
    representatives[0].name.first
    representatives[0].address.address
  else:
    agents[0].name.first
  agents[0].name.last
  agents[0].address.address
  if has_alternate:
    alternates[0].address.address
  # else:
  #   Massachusetts_Healthcare_Proxy = True
  # basic_questions_signature_flow = False
  nav.set_section('review_Massachusetts_Healthcare_Proxy')
  Massachusetts_Healthcare_Proxy_download
---
id: intro screen
decoration: form-lineal
question: |
  Designate your Health Care Agent using this interview.
subquestion: |
  The MassAccess Project can help **Massachusetts residents** complete and submit forms in 3 steps:

  Step 1. Answer questions that will fill in your form for you.

  Step 2. Preview the completed form.

  Step 3. Download and print the final form. You will need to sign it in the presence of two witnesses and deliver it your healthcare provider.

  Tap the {green words} in any screen for a definition or more information.

fields:
  - To continue, you must accept the [terms of use](https://massaccess.suffolklitlab.org/privacy/): acknowledged_information_use
    datatype: checkboxes
    none of the above: False
    minlength: 1
    choices:
      - I accept the terms of use.
    validation messages:
      minlength: |
        You cannot continue unless you agree to the terms of use.
continue button field: proxy_questions_intro_screen
terms:
  green words: |
    Green words are legal terms or a short way of referring to something that needs more explanation. The definition or explanation pops up when you tap the green words.
---
continue button field: warning_screen
question: |
  Warning!
subquestion: |
  **You must be 18 years or older to complete this form and you must complete this form of your own free will.**
  
  This form is intended for residents of **Massachusetts**. Please look up the Healthcare Proxy rules in other states if you wish to determine whether the form will be valid in other states.
---
id: Massachusetts Healthcare Proxy Form
continue button field: Massachusetts_Healthcare_Proxy_intro
question: |
  Massachusetts Healthcare Proxy Form
subquestion: |
  You can use this form to name someone you trust to make healthcare decisions on your behalf if you lose the ability to do so for yourself. This person is called a Healthcare Agent.
  
  **It is highly recommended that you discuss your healthcare choices with your Healthcare Agent prior to completing this form. If you need additional resources please talk to your doctor or visit resources like masshealthdecisions.org.**
  
  You may revoke a healthcare proxy at any time by letting your healthcare agent or a health care provider know orally or in writing or by any other act evidencing a specific intent to revoke the proxy.
progress: 10
---
id: Preview screen
continue button field: Massachusetts_Healthcare_Proxy_preview_question
question: |
  Health Care Proxy Form Preview
subquestion: |
  Here is a preview of your form.

  You may click the file to review your answers. You can use the back button to navigate to previous screens to correct mistakes.

   ${Massachusetts_Healthcare_Proxy_attachment['preview']}
progress: 90
---
objects:
  - user: VCIndividual
  - agents: PeopleList
  - alternates: PeopleList
  - representatives: PeopleList
---
id: Tell us about the principal
question: |
  Tell us about the Principal.
subquestion: |
  The Principal is the person who would like to designate their healthcare decisions to someone else if they are unable to make those decisions themself.
fields:
  - First Name: users[0].name.first
  - Middle Name: users[0].name.middle
    required: False
  - Last Name: users[0].name.last
  - Suffix: users[0].name.suffix
    code: |
      name_suffix()
    required: False
---
id: Birth Date
question: |
  What is ${ users[0].name.first}'s date of birth?
fields:
  - Birthdate: users[0].birthdate
    datatype: date
progress: 20
---
id: your address
question: |
  What is ${ users[0].name.first} 's address?
subquestion: |
  Use the address where ${ users[0].name.first} currently recieves mall.
fields:
  - Street address: users[0].address.address
    address autocomplete: True
  - Unit: users[0].address.unit
    required: False
  - City: users[0].address.city
  - State: users[0].address.state
    code: |
      states_list()
    default: MA
  - Zip: users[0].address.zip
    required: False
progress: 15
---
id: Tell us about your healthcare agent.
generic object: Individual
question: |
  Tell us about ${ users[0].name.first }'s healthcare agent.
subquestion: |
   ${ users[0].name.first }'s healthcare agent is the person that they are selecting to make healthcare decisions on their behalf if they are unable to. Provide the information of the person ${ users[0].name.first} has elected as their Healthcare Agent.
fields:
  - First Name: agents[0].name.first
  - Middle Name: agents[0].name.middle
    required: False
  - Last Name: agents[0].name.last
---
id: Healthcare agent contact info
question: |
  Provide ${ agents[0].name.first }'s contact information.
fields:
  - Street Address: agents[0].address.address
    address autocomplete: True
  - Unit: agents[0].address.unit
    required: False
    help: The apartment, suite, or unit number of the residence.
  - City: agents[0].address.city
  - State: agents[0].address.state
    code: |
      states_list()
    default: MA
  - Zip: agents[0].address.zip
  - Mobile Number: agent_phone_home
  - Work Number: agent_phone_work
    required: false
  - E-mail: agent_email
    required: false
progress: 50
---
id: Do you have an alternate healthcare agent?
continue button field: Do_you_have_an_alternate_healthcare_agent
question: |
  Designate a back-up healthcare agent
subquestion: |
  You may add an back-up agent who will take the primary agent's place in the event that they are unable or unwilling to make healthcare decisions on your behalf. Add the back-up agent's details below.
fields:
  - "Would you like to designate a back-up healthcare agent?": has_alternate
    datatype: yesnoradio
    required: false
  - "First Name":  alternates[0].name.first
    show if: has_alternate
  - "Last Name":  alternates[0].name.last
    show if: has_alternate
progress: 65
---
id: Alt. Address
question: |
  Provide ${ alternates[0].name.first }'s contact information
fields:
  - Street Address: alternates[0].address.address
    address autocomplete: True
  - Unit: alternates[0].address.unit
    required: False
    help: The apartment, suite, or unit number of the residence.
  - City: alternates[0].address.city
  - State: alternates[0].address.state
    code: |
      states_list()
    default: MA
  - Zip: alternates[0].address.zip
  - Phone number: alternate_phone
---
id: exceptions
question: |
  Do you want to put any restrictions on the decisions your healthcare agent can make?
subquestion: |
  If you want to limit the decisions your healthcare agent can make, you can list exceptions below. For example, you could add that your healthcare agent is not authorized to deny pain medications, make life-sustaining decisions, or any other limitation you decide. If you do not wish to put any limitations on the healthcare decisions your agent can make, you do not need to provide any exceptions.
fields:
  - "Are there any restrictions to the healthcare decisions your agent can make?": has_exceptions
    datatype: yesnoradio
    required: false
  - "Please list your exceptions here": agent_exceptions
    input type: area
    rows: 10
    show if: has_exceptions
---
id: Is someone other than you signing on your behalf?
question: |
  Who is completing this form?
subquestion: |
  If the person who is selecting a health care agent is physically unable to, they may designate a representative to sign on their behalf by completing the fields below.
fields:
  - "Are you completing this form for someone who is physically unable to complete it?": has_representative
    datatype: yesnoradio
  - First Name: representatives[0].name.first
    required: False
    show if: has_representative
  - Last Name: representatives[0].name.last
    required: False
    show if: has_representative
---
id: Alt. Address
question: |
  Provide ${ representatives[0].name.first }'s contact information
fields:
  - Street Address: representatives[0].address.address
    address autocomplete: True
  - Unit: representatives[0].address.unit
    required: False
    help: The apartment, suite, or unit number of the residence.
  - City: representatives[0].address.city
  - State: representatives[0].address.state
    code: |
      states_list()
    default: MA
  - Zip: representatives[0].address.zip
  - note: |
      The representative will need to sign on the principal's behalf in the presence of the principal and two adult witnesses.
progress: 35
---
progress: 100
event: Massachusetts_Healthcare_Proxy_download
id: Download screen Massachusetts_Healthcare_Proxy
question: |
  Your Form is Complete!
subquestion: |
  Your Health Care Proxy form is ready to download. You will need to print it, sign it in the presence of two witnesses and file it with your health care provider.
  
  ### Next steps
  
  1. Download and print the form.
  2. Sign it in the presence of two adult witnesses.
  3. File it with your health care provider.
  4. Make sure to keep a copy for yourself.
  
  Below is a copy of your form.

  ${ al_user_bundle.download_list_html() }
  
  ${ al_user_bundle.send_button_html() }
---
objects:
  - Massachusetts_Healthcare_Proxy_attachment: ALDocument.using(title="Healthcare Proxy", filename="healthcare_proxy.pdf", enabled=True, has_addendum=True, default_overflow_message=" [See addendum]")
---
code: |
  Massachusetts_Healthcare_Proxy_attachment.overflow_fields['agent_exceptions'].overflow_trigger = 150
  Massachusetts_Healthcare_Proxy_attachment.overflow_fields.gathered = True
---
objects:
  - al_user_bundle: ALDocumentBundle.using(elements=[Massachusetts_Healthcare_Proxy_attachment], title="Healthcare Proxy", filename="healthcare_proxy")
  - al_court_bundle: ALDocumentBundle.using(elements=[Massachusetts_Healthcare_Proxy_attachment], title="Healthcare Proxy", filename="healthcare_proxy")  
---
#TODO - Work with Q to fix addendum over character limit then use the logic below.
#code: |
#  if over_max_char:
#    Health_Care_Proxy_addendum_attachment.enabled = True
#    agent_exceptions == "See attached addendum"
#  else:
#    Health_Care_Proxy_addendum_attachment.enabled = False
---
attachment:
    variable name: Massachusetts_Healthcare_Proxy_attachment[i]
    name: Healthcare Proxy
    filename: Healthcare_Proxy
    skip undefined: True
    pdf template file: Massachusetts_Healthcare_Proxy.pdf
    fields:
      - "users0_birthdate": ${ users[0].birthdate }
      - "users0_name_first": ${ users[0].name.first }
      - "users0_name_middle": ${ users[0].name.middle }
      - "users0_name_last": ${ users[0].name.last }
      - "users0_name_suffix": ${ users[0].name.suffix }
      - "users0_name_full": ${ str(users[0]) }
      - "users0_address_address": ${ users[0].address.address }
      - "users0_address_city": ${ users[0].address.city }
      - "users0_address_zip": ${ users[0].address.zip }
      - "users0_address_state": ${ users[0].address.state }
      - "agents0_name_first": ${ agents[0].name.first }
      - "agents0_name_middle": ${ agents[0].name.middle }
      - "agents0_name_last": ${ agents[0].name.last }
      - "agents0_name_suffix": ${ agents[0].name.suffix }
      - "agents0_name_full": ${ str(agents[0]) }
      - "agents0_address_address": ${ agents[0].address.address }
      - "agents0_address_state": ${ agents[0].address.state }
      - "agents0_address_city": ${ agents[0].address.city }
      - "agents0_address_zip": ${ agents[0].address.zip }
      - "agent_phone_work": ${ agent_phone_work }
      - "agent_email": ${ agent_email }
      - "agent_phone_home": ${ agent_phone_home }
      - "alternates0_name_first": ${ alternates[0].name.first }
      - "alternates0_name_middle": ${ alternates[0].name.middle }
      - "alternates0_name_last": ${ alternates[0].name.last }
      - "alternates0_name_suffix": ${ alternates[0].name.suffix }
      - "alternates0_name_full": ${ str(alternates0[0]) }
      - "alternates0_address_address": ${ alternates[0].address.address }
      - "alternates0_address_zip": ${ alternates[0].address.zip }
      - "alternates0_address_state": ${ alternates[0].address.state }
      - "alternates0_address_city": ${ alternates[0].address.city }
      - "alternate_phone": ${ alternate_phone }
      - "agent_exceptions": ${ Massachusetts_Healthcare_Proxy_attachment.safe_value('agent_exceptions') }
      - "representatives0_name_first": ${ representatives[0].name.first }
      - "representatives0_name_last": ${ representatives[0].name.last }
      - "representatives0_name_full": ${ str(representatives0[0]) }
      - "representatives0_address_address": ${ representatives[0].address.address }
      - "representatives0_address_city": ${ representatives[0].address.city }
      - "representatives0_address_state": ${ representatives[0].address.state }
      - "representatives0_address_zip": ${ representatives[0].address.zip }
---
id: Massachusetts_Healthcare_Proxy review screen
event: review_Massachusetts_Healthcare_Proxy
question: |
  Review your answers
subquestion: |
  Edit your answers below
review:
  - Edit: |-
      users[0].name.first
    button: |-
      Your name : ${ users[0] }
  - Edit: |-
      users[0].birthdate
    button: |-
      Birthdate : ${ users[0].birthdate }
  - Edit: |-
      users[0].address.address
    button: |-
      Your address : ${ users[0].address.on_one_line() }
  - Edit: |-
      agents[0].name.first
    button: |-
      Agent's Name : ${ agents[0] }
  - Edit: |-
      agents[0].address.address
    button: |-
      Agent's Address : ${ agents[0].address.on_one_line() }
  - Edit: |-
      agent_phone_home
    button: |-
      Mobile Number : ${ agent_phone_home }
  - Edit: |-
      agent_phone_work
    button: |-
      Work Number : ${ agent_phone_work }
  - Edit: |-
      agent_email
    button: |-
      E-mail : ${ agent_email }
  - Edit: |-
      has_alternate
    button: |-
      Would you like to designate a back-up healthcare agent? : ${ has_alternate }
  - Edit: |-
      alternates[0].name.first
    button: |-
      First Name : ${ alternates[0].name.first }
  - Edit: |-
      alternates[0].name.last
    button: |-
      Last Name : ${ alternates[0].name.last }
  - Edit: |-
      alternates[0].address.address
    button: |-
      Alternate's Address : ${ alternates[0].address.on_one_line() }
  - Edit: |-
      alternate_phone
    button: |-
      Alternate's Phone number : ${ alternate_phone }
  - Edit: |-
      has_exceptions
    button: |-
      Are there any restrictions to the healthcare decisions your agent can make? : ${ has_exceptions }
  - Edit: |-
      agent_exceptions
    button: |-
      Please list your exceptions here :       
      > ${ agent_exceptions }
  - Edit: |-
      has_representative
    button: |-
      Are you completing this form for someone who is physically unable to complete it? : ${ has_representative }
  - Edit: |-
      representatives[0].name.first
    button: |-
      Name of representative : ${ representatives[0] }
  - Edit: |-
      representatives[0].address.address
    button: |      
      Address : ${ representatives[0].address.on_one_line() }
